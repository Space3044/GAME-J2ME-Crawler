# 游戏爬虫控制台 (Game Crawler Console)

这是一个基于 Python Flask 和 Playwright 的网页爬虫工具，专门用于抓取游戏网站的数据。它提供了一个 Web 界面来管理任务、监控进度、处理失败项目以及导出数据。

## 功能特点

*   **Web 管理界面**: 直观的操作界面，支持任务创建、暂停、继续和停止。
*   **断点续传**: 自动保存进度，随时可以暂停和恢复。
*   **失败重试**: 自动记录抓取失败的项目，支持一键将失败项目加入重试队列。
*   **数据完整性检查**: 扫描已抓取的数据，找出缺失的 ID 或无效内容（如标题为空），并将其加入重试队列。
*   **Excel 导出**: 将抓取的数据导出为 Excel 文件，自动处理非法字符。
*   **并发控制**: 单线程运行，避免对目标网站造成过大压力，支持自定义延迟。

## 安装与运行

1.  **安装依赖**:
    ```bash
    pip install -r requirements.txt
    playwright install chromium
    ```

2.  **运行程序**:
    ```bash
    python app.py
    ```

3.  **访问界面**:
    打开浏览器访问 `http://localhost:5000`

## 使用指南

### 1. 创建任务
*   在左侧面板输入任务名称（可选）。
*   输入起始 ID 和终止 ID（例如 31895 到 47658）。
*   点击“创建任务”。

### 2. 控制爬虫
*   **开始/继续**: 启动爬虫或从上次暂停处继续。
*   **暂停**: 暂时停止爬虫，保持当前进度。
*   **停止**: 完全停止爬虫任务。
*   **延迟设置**: 可以动态调整每次抓取之间的等待时间（秒）。

### 3. 错误处理与维护
*   **检查缺漏/错误**: 点击此按钮，系统会扫描当前任务的所有数据。
    *   它会找出范围内未抓取的 ID。
    *   它会找出标题为空或为特定错误信息（如“老游戏在线玩”）的项目。
    *   这些 ID 会被静默加入“重试队列”。
*   **重试失败项目**: 点击此按钮（如果红色按钮显示数量 > 0），爬虫将优先处理重试队列中的 ID。
    *   重试时，界面上的“当前 ID”会显示正在重试的项目 ID。
    *   重试成功的数据会覆盖旧的无效数据。

### 4. 数据导出
*   点击“导出 Excel”按钮下载当前任务的所有数据。

## 文件结构

*   `app.py`: Flask 后端服务器，处理 API 请求。
*   `crawler.py`: 核心爬虫逻辑，使用 Playwright。
*   `storage.py`: 任务数据管理（JSON 文件读写）。
*   `exporter.py`: Excel 导出逻辑。
*   `templates/index.html`: 前端界面。
*   `tasks/`: 存储任务数据的 JSON 文件目录。

## 注意事项

*   爬虫运行期间请勿关闭控制台窗口。
*   如果遇到网络错误，爬虫会自动暂停，请检查网络后点击“继续”。
